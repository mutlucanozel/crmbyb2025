<!-- Bootstrap 5 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<style>
    .dual-listbox-container {
        display: flex;
        gap: 2rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .dual-listbox-select {
        flex: 1;
        min-width: 250px;
    }

    .dual-listbox-select select {
        width: 100%;
        height: 250px;
        padding: 0.5rem;
        border-radius: 0.5rem;
        border: 1px solid #ced4da;
    }

    .dual-listbox-controls {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .dual-listbox-controls button {
        min-width: 60px;
        font-size: 1.25rem;
        padding: 0.5rem 1rem;
    }

    .results-table {
        margin-top: 2rem;
    }

    .status-success {
        color: green;
        font-weight: bold;
    }

    .status-fail {
        color: red;
        font-weight: bold;
    }

    .form-section {
        background: #f8f9fa;
        padding: 2rem;
        border-radius: 1rem;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }
</style>

<div class="container"> 
<div class="form-section mt-4">
    <form method="post" asp-action="SendMessage">
        <h4 class="mb-4">ğŸ‘¥ KiÅŸi SeÃ§imi ve Mesaj GÃ¶nderme</h4>

        <div class="dual-listbox-container">
            <!-- Available Users -->
            <div class="dual-listbox-select">
                <label class="form-label">TÃ¼m KullanÄ±cÄ±lar</label>
                <select id="availableUsers" multiple>
                    @foreach (var user in (List<SelectListItem>)ViewBag.Users)
                        {
                        <option value="@user.Value">@user.Text</option>
                        }
                </select>
            </div>

            <!-- Controls -->
            <div class="dual-listbox-controls">
                <button type="button" class="btn btn-outline-primary" id="addUser" title="SeÃ§ilenleri Ekle">â†’</button>
                <button type="button" class="btn btn-outline-danger" id="removeUser"
                    title="SeÃ§ilenleri KaldÄ±r">â†</button>
            </div>

            <!-- Selected Users -->
            <div class="dual-listbox-select">
                <label class="form-label">SeÃ§ilen KullanÄ±cÄ±lar</label>
                <select id="selectedUsers" name="phoneNumbers" multiple required></select>
            </div>
        </div>

        <div class="mt-4">
            <label class="form-label" for="message">ğŸ“© Mesaj Ä°Ã§eriÄŸi</label>
            <textarea class="form-control" id="message" name="message" rows="4" placeholder="MesajÄ±nÄ±zÄ± yazÄ±n..."
                required></textarea>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-success btn-lg">ğŸ“¤ MesajÄ± GÃ¶nder</button>
        </div>
    </form>
</div></div>

<!-- Results Table -->
@if (ViewBag.Results != null)
{
<div class="results-table">
    <h4 class="mt-5">ğŸ“¬ GÃ¶nderim SonuÃ§larÄ±</h4>
    <table class="table table-striped table-bordered mt-3">
        <thead class="table-dark">
            <tr>
                <th>ğŸ“ Telefon</th>
                <th>ğŸ”„ Durum</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var result in (List<(string PhoneNumber, string Status)>)ViewBag.Results)
                {
                <tr>
                    <td>@result.PhoneNumber</td>
                    <td class="@(result.Status.Contains(" BaÅŸarÄ±lÄ±") ? "status-success" : "status-fail" )">
                        @result.Status</td>
                </tr>
                }
        </tbody>
    </table>
</div>
}
<script>
    // KullanÄ±cÄ±larÄ± taÅŸÄ±ma iÅŸlemleri
    document.getElementById('addUser').addEventListener('click', function () {
        moveOptions('availableUsers', 'selectedUsers');
    });

    document.getElementById('removeUser').addEventListener('click', function () {
        moveOptions('selectedUsers', 'availableUsers');
    });

    function moveOptions(fromId, toId) {
        const from = document.getElementById(fromId);
        const to = document.getElementById(toId);

        Array.from(from.selectedOptions).forEach(option => {
            to.appendChild(option);
        });
    }

    // GÃ¶nderim Ã¶ncesi seÃ§ilenleri iÅŸaretle
    document.querySelector('form').addEventListener('submit', function () {
        const selectedUsers = document.getElementById('selectedUsers');
        Array.from(selectedUsers.options).forEach(opt => opt.selected = true);
    });

    const results = [];

@if (ViewBag.Results != null)
{
    foreach (var result in (List<(string PhoneNumber, string Status)>)ViewBag.Results)
    {
        <text>
            results.push({
                phone: "@result.PhoneNumber",
                status: "@Html.Raw(result.Status)"
            });
        </text>
    }
}

results.forEach(function (res) {
    Toastify({
        text: res.phone + " - " + res.status,
        duration: 5000,
        gravity: "top",
        position: "right",
        close: true,
        style: {
            background: res.status.includes("BaÅŸarÄ±lÄ±") ? "#198754" : "#dc3545",
            color: "#fff",
            borderRadius: "8px",
            padding: "10px 16px",
            fontSize: "14px"
        }
    }).showToast();
});
</script>