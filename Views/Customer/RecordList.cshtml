<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÃ¼ÅŸteri Listesi</title>
    <link rel="stylesheet" type="text/css" href="~/css/listcustomer.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

</head>
<style>
      .filter-button {
        border-width: 2px !important; /* KalÄ±nlaÅŸtÄ±r */
        border-color: #6c757d !important; /* Normal outline rengi */
    }
    .active-btn {
        color: #fff !important;
        font-weight: bold;
    }
    /* FarklÄ± renklere Ã¶zel borderlar */
    .btn-outline-secondary {
        border-color: #6c757d !important;
    }
    .btn-outline-primary {
        border-color: #007bff !important;
    }
    .btn-outline-success {
        border-color: #28a745 !important;
    }
    .btn-outline-info {
        border-color: #17a2b8 !important;
    }
    .btn-outline-danger {
        border-color: #dc3545 !important;
    }
    .btn-outline-dark {
        border-color: #343a40 !important;
    }

    /* Ä°stersen hover efektini de belirginleÅŸtiririz */
    .filter-button:hover {
        box-shadow: 0 0 10px rgba(0,0,0,0.2); /* Hafif gÃ¶lge efekti */
    }
</style>
@using System.Security.Claims
@{
var firstName = System.Net.WebUtility.HtmlDecode(User.FindFirst("FirstName")?.Value ?? string.Empty);
var lastName = System.Net.WebUtility.HtmlDecode(User.FindFirst("LastName")?.Value ?? string.Empty);

ViewBag.UserName = $"{firstName} {lastName}";
}

<div class="container">
    <h4 class="display-4 text-center">KayÄ±t Listesi</h4>
    <hr>
    <div class="d-flex justify-content-between align-items-center mb-3" style="gap: 10px;">
        <input type="text" class="form-control search-input-custom" id="searchInput"
            placeholder="Herhangi bir parametre ile ara..." style="margin: 0; flex-grow: 1; height: 60px;">

    </div>
    <div class="d-flex flex-wrap gap-2 justify-content-center mb-3" style="row-gap: 10px; column-gap: 10px;">


        <button class="btn btn-outline-dark filter-button" data-status="all">TÃ¼mÃ¼nÃ¼ GÃ¶ster</button>
        <button class="btn btn-secondary filter-button" data-status="GÃ¶rev">GÃ¶rev</button>
        <button class="btn btn-primary filter-button" data-status="Ziyaret">Ziyaret</button>
        <button class="btn btn-success filter-button" data-status="Telefon">Telefon</button>
        <button class="btn btn-info filter-button" data-status="Email">Email</button>
        <button class="btn btn-danger filter-button" data-status="Numune">Numune</button>
        
        <button class="btn btn-outline-dark  btn-lg"
        onclick="exportTableToExcel('user-table', 'MusteriListesi.xlsx')">
        Tabloyu Excel'e Aktar <i class="fa-solid fa-download"></i>
    </button>
    </div>
    
    <div class="button-container">




        <!-- <button class="btn btn-outline-dark mb-3 btn-lg" id="deleteSelected">
            SeÃ§ilen MÃ¼ÅŸterileri Sil <i class="fa fa-trash"></i>
        </button> -->
    </div>
    <hr>

    <div class="table-header" style="text-align: center;">
        <h5 id="customerCount"
            style="font-size: 1.2em; font-weight: bold; color: #4F75FF; border: 2px solid #4379F2; display: inline-block; padding: 10px 20px; border-radius: 8px; background-color: #f0f8ff;">
            Listelenen KayÄ±tlarÄ±n SayÄ±sÄ±: 0
        </h5>
    </div>
    <div class="table-responsive">
        <table id="user-table" class="user-table table table-bordered">
            <thead>
                <tr>
                    <th>KayÄ±t Id</th>
                    <th>MÃ¼ÅŸteri AdÄ±</th>
                    <th>MÃ¼ÅŸteri Id</th>
                    <th>MÃ¼ÅŸteri Sorumlusu</th>
                    <th>Durum</th>
                    <th>Planlanan Tarih</th>
                    <th>GerÃ§ekleÅŸen Tarih</th>
                    <th>Bilgi</th>
                    <th>Ä°ÅŸlemler</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                foreach (var record in Model)
                {
                <tr>
                    <td>@record.Id</td>
                    <td>@record.Customer?.Name</td> <!-- MÃ¼ÅŸteri adÄ± iliÅŸkilendirme -->
                    <td>@record.Customer.Id</td>
                    <td>@record.Customer.CreatedBy</td>
                    <td>
                        <span class="badge px-3 py-2 fs-5 @(record.Status switch{
                            " GÃ¶rev"=> "bg-secondary text-white",
                            "Ziyaret" => "bg-primary text-white",
                            "Telefon" => "bg-success text-white",
                            "Email" => "bg-info text-white",
                            "Numune" => "bg-danger text-white",
                            _ => "bg-dark text-white"
                            })">
                            @record.Status
                        </span>
                    </td>

                    <td>@record.PlannedDate?.ToString("dd.MM.yyyy")</td>
                    <td>@record.ActualDate?.ToString("dd.MM.yyyy")</td>
                    <td>@record.Information</td>
                    <td style="text-align: center; vertical-align: middle;">
                        <a class="btn btn-dark" href="@Url.Action("CustomerDetail", "Customer" , new {
                            id=record.Customer.Id })"
                            style="display: inline-flex; justify-content: center; align-items: center; width: 60px; height: 60px;">
                            <i class='fas fa-sign-in-alt' style="font-size: 24px; margin: 0;"></i>
                        </a>
                    </td>
                </tr>
                }
                }
                else
                {
                <tr>
                    <td colspan="8">Veri yÃ¼klenemedi</td>
                </tr>
                }
            </tbody>
        </table>

    </div>
    <hr>
</div>






<script>
    
    document.querySelectorAll('.filter-button').forEach(function (button) {
    button.addEventListener('click', function () {
        const selectedStatus = this.getAttribute('data-status').trim();
        const rows = document.querySelectorAll('.user-table tbody tr');

        // SatÄ±rlarÄ± filtrele
        rows.forEach(function (row) {
            const statusCell = row.querySelector('td:nth-child(5) span');
            if (statusCell) {
                const statusText = statusCell.textContent.trim();
                if (selectedStatus === "all" || statusText === selectedStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }
        });

        // TÃ¼m butonlarÄ±n aktif durumunu kaldÄ±r
        document.querySelectorAll('.filter-button').forEach(function (btn) {
            btn.classList.remove('active-btn', 'btn-secondary', 'btn-primary', 'btn-success', 'btn-info', 'btn-danger', 'btn-dark');
            btn.classList.add('btn-outline-dark', 'btn-outline-secondary', 'btn-outline-primary', 'btn-outline-success', 'btn-outline-info', 'btn-outline-danger');
        });

        // Åžu an tÄ±klanan butonu aktif hale getir
        this.classList.remove('btn-outline-dark', 'btn-outline-secondary', 'btn-outline-primary', 'btn-outline-success', 'btn-outline-info', 'btn-outline-danger');

        switch (selectedStatus) {
            case 'GÃ¶rev':
                this.classList.add('btn-secondary', 'active-btn');
                break;
            case 'Ziyaret':
                this.classList.add('btn-primary', 'active-btn');
                break;
            case 'Telefon':
                this.classList.add('btn-success', 'active-btn');
                break;
            case 'Email':
                this.classList.add('btn-info', 'active-btn');
                break;
            case 'Numune':
                this.classList.add('btn-danger', 'active-btn');
                break;
            case 'all':
            default:
                this.classList.add('btn-dark', 'active-btn');
                break;
        }

        updateCustomerCount();
    });
    });
    document.addEventListener("DOMContentLoaded", function () {
        const table = document.getElementById("user-table");
        const headers = table.querySelectorAll("thead th");
        const tbody = table.querySelector("tbody");
        let currentSortColumn = null;
        let currentSortOrder = "asc";

        headers.forEach((header, index) => {
            header.addEventListener("click", function () {
                // TÃ¼m sÃ¼tunlardan "active" sÄ±nÄ±fÄ±nÄ± kaldÄ±r.
                headers.forEach(h => {
                    h.classList.remove("active");
                    const icon = h.querySelector(".sort-icon");
                    if (icon) icon.remove();
                });

                // Åžimdiki sÃ¼tunu vurgula.
                header.classList.add("active");

                // SÄ±ralama yÃ¶nÃ¼nÃ¼ belirle.
                if (currentSortColumn === index) {
                    currentSortOrder = currentSortOrder === "asc" ? "desc" : "asc";
                } else {
                    currentSortColumn = index;
                    currentSortOrder = "asc";
                }

                // SÄ±ralama ikonu ekle.
                const sortIcon = document.createElement("span");
                sortIcon.classList.add("sort-icon");
                sortIcon.innerHTML = currentSortOrder === "asc" ? "â–²" : "â–¼";
                header.appendChild(sortIcon);

                // SatÄ±rlarÄ± sÄ±rala.
                const rows = Array.from(tbody.querySelectorAll("tr"));
                rows.sort((rowA, rowB) => {
                    const cellA = rowA.children[index].innerText.trim();
                    const cellB = rowB.children[index].innerText.trim();

                    // SayÄ±sal sÄ±ralama kontrolÃ¼
                    if (!isNaN(cellA) && !isNaN(cellB)) {
                        return currentSortOrder === "asc"
                            ? Number(cellA) - Number(cellB)
                            : Number(cellB) - Number(cellA);
                    }

                    // Tarih sÄ±ralama kontrolÃ¼
                    const dateRegex = /^\d{2}\.\d{2}\.\d{4}$/; // Ã–rn: "28.12.2024"
                    if (dateRegex.test(cellA) && dateRegex.test(cellB)) {
                        const dateA = new Date(cellA.split('.').reverse().join('-'));
                        const dateB = new Date(cellB.split('.').reverse().join('-'));
                        return currentSortOrder === "asc" ? dateA - dateB : dateB - dateA;
                    }

                    // Alfabetik sÄ±ralama kontrolÃ¼
                    return currentSortOrder === "asc"
                        ? cellA.localeCompare(cellB, 'tr')
                        : cellB.localeCompare(cellA, 'tr');
                });

                // SÄ±ralanmÄ±ÅŸ satÄ±rlarÄ± yeniden ekle.
                rows.forEach(row => tbody.appendChild(row));
            });
        });
    });
    async function exportTableToExcel(tableID, filename = 'MusteriListesi.xlsx') {
        try {
            const table = document.getElementById(tableID);

            // Yeni bir workbook oluÅŸtur
            const workbook = new ExcelJS.Workbook();
            const worksheet = workbook.addWorksheet("MÃ¼ÅŸteri Listesi");

            // Tablonun baÅŸlÄ±klarÄ±nÄ± al
            const headerRow = table.querySelector("thead tr");
            const headers = Array.from(headerRow.querySelectorAll("th"))
                .map(cell => cell.textContent.trim())
                .filter(header => header !== "Ä°ÅŸlemler"); // "Ä°ÅŸlemler" sÃ¼tununu hariÃ§ tut

            // BaÅŸlÄ±klarÄ± Excel'e ekle
            const excelHeaderRow = worksheet.addRow(headers);
            excelHeaderRow.eachCell(cell => {
                cell.font = { bold: true }; // BaÅŸlÄ±klarÄ± kalÄ±n yap
                cell.alignment = { horizontal: "center", vertical: "middle" };
            });

            // Tablodaki verileri al
            const rows = Array.from(table.querySelectorAll("tbody tr")).filter(row => row.style.display !== "none");

            rows.forEach(row => {
                const rowData = Array.from(row.querySelectorAll("td"))
                    .map(cell => cell.textContent.trim());

                // "Ä°ÅŸlemler" sÃ¼tununun indeksini belirle ve o sÃ¼tunu hariÃ§ tut
                const operationColumnIndex = Array.from(headerRow.querySelectorAll("th"))
                    .findIndex(cell => cell.textContent.trim() === "Ä°ÅŸlemler");

                if (operationColumnIndex !== -1) {
                    rowData.splice(operationColumnIndex, 1);
                }

                worksheet.addRow(rowData).eachCell(cell => {
                    cell.alignment = { horizontal: "center", vertical: "middle" };
                });
            });

            // Kolon geniÅŸliklerini ayarla
            worksheet.columns = headers.map(() => ({ width: 20 }));

            // Excel dosyasÄ±nÄ± indir
            const buffer = await workbook.xlsx.writeBuffer();
            const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        } catch (error) {
            console.error("Excel'e aktarÄ±lÄ±rken hata oluÅŸtu:", error);
            alert("Excel'e aktarÄ±lÄ±rken hata oluÅŸtu! DetaylarÄ± konsoldan kontrol edin.");
        }
    }



    document.getElementById('searchInput').addEventListener('keyup', function () {
        // KullanÄ±cÄ±nÄ±n girdiÄŸi arama deÄŸerini al ve TÃ¼rkÃ§e karakterlere duyarlÄ± olarak kÃ¼Ã§Ã¼lt
        var searchValue = this.value.toLocaleLowerCase('tr-TR').trim();

        // Arama deÄŸerini boÅŸluklara gÃ¶re bÃ¶l ve kelimeleri al
        var searchTerms = searchValue.split(' ').filter(function (term) {
            return term.trim() !== ''; // BoÅŸ olmayan terimleri al
        });

        // Arama iÅŸlemini baÅŸlat
        filterTable(searchTerms);
    });

    function filterTable(searchTerms) {
        // Tablo satÄ±rlarÄ±nÄ± seÃ§
        var tableRows = document.querySelectorAll('.user-table tbody tr');

        // Her bir satÄ±rÄ± kontrol et
        tableRows.forEach(function (row) {
            // SatÄ±rÄ±n text iÃ§eriÄŸini TÃ¼rkÃ§e karakterlere duyarlÄ± olarak kÃ¼Ã§Ã¼lt
            var rowText = row.textContent.toLocaleLowerCase('tr-TR').trim();

            // Her bir arama teriminin satÄ±r metninde olup olmadÄ±ÄŸÄ±nÄ± kontrol et
            var matchesSearch = searchTerms.every(function (term) {
                return rowText.includes(term);
            });

            // Arama kriterlerine uyan satÄ±rlarÄ± gÃ¶ster, uymayanlarÄ± gizle
            if (matchesSearch) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
        updateCustomerCount();
    }
    function updateCustomerCount() {
        const visibleRows = document.querySelectorAll(".user-table tbody tr:not([style*='display: none'])");
        const totalCustomers = visibleRows.length;
        document.getElementById("customerCount").innerText = "Listelenen KayÄ±tlarÄ±n SayÄ±sÄ±: " + totalCustomers;
    }
    // Sayfa yÃ¼klendiÄŸinde mÃ¼ÅŸteri sayÄ±sÄ±nÄ± ilk olarak gÃ¼ncelle
    document.addEventListener("DOMContentLoaded", function () {
        updateCustomerCount();
    });

    $(document).ready(function () {

        var createdBy = '@Html.Raw(ViewBag.UserName)';

        $('#addCustomerModal').on('show.bs.modal', function () {
            $('#CreatedBy').val(createdBy);

        });

        document.getElementById('newSector').addEventListener('input', function () {
            this.value = this.value.toUpperCase();
        });
        $(document).on('click', '.delete-customer', function (event) {
            event.stopPropagation(); // TÄ±klamanÄ±n satÄ±rÄ± seÃ§mesini engelle

            var customerId = $(this).data('id');

            Swal.fire({
                title: 'Emin misiniz?',
                text: "Bu mÃ¼ÅŸteriyi silmek istediÄŸinize emin misiniz?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Evet, sil!',
                cancelButtonText: 'HayÄ±r, iptal et',
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '@Url.Action("DeleteCustomer", "Customer")',
                        type: 'POST',
                        data: { id: customerId },
                        success: function (result) {
                            if (result.success) {
                                // Toastify mesajÄ±nÄ± gÃ¶stermek iÃ§in localStorage'a bir flag ekle
                                localStorage.setItem('customerDeleted', 'true');

                                // SayfayÄ± hemen yenile
                                location.reload();
                            } else {
                                Toastify({
                                    text: "Silme iÅŸlemi yapÄ±lamadÄ±! " + result.message,
                                    duration: 5000,
                                    gravity: "top",
                                    position: "center",
                                    backgroundColor: "#FF0000", // Hata durumu (kÄ±rmÄ±zÄ±)
                                    stopOnFocus: true,
                                }).showToast();
                            }
                        },
                        error: function (err) {
                            Toastify({
                                text: "Hata! MÃ¼ÅŸteri silmek iÃ§in yetkiye sahip olduÄŸunuzdan emin olun!",
                                duration: 5000, // 5 saniye boyunca gÃ¶rÃ¼nÃ¼r

                                gravity: "top",
                                position: "center",
                                backgroundColor: "#FF0000", // Hata durumu (kÄ±rmÄ±zÄ±)
                                stopOnFocus: true,
                            }).showToast();
                        }

                    });
                    // Checkbox seÃ§im iÅŸlemi iÃ§in tÄ±klama olayÄ±nÄ± ayrÄ± yÃ¶net
                    // $('.user-table tbody').on('click', 'tr', function (event) {
                    //     if (!$(event.target).is('.delete-customer, .btn-outline-success, .fa-pencil-alt, .fa-trash, input[type="checkbox"]')) {
                    //         // TÄ±klanan yer silme butonu veya dÃ¼zenleme butonu deÄŸilse
                    //         var checkbox = $(this).find('.selectCustomer');
                    //         checkbox.prop('checked', !checkbox.prop('checked'));
                    //     }
                    // });

                }
            });
        });

        $('#addSectorButton').on('click', function () {
            var newSectorName = $('#newSector').val();
            if (newSectorName) {
                $.ajax({
                    url: '@Url.Action("AddSector", "Customer")',
                    type: 'POST',
                    data: { name: newSectorName },
                    success: function (result) {
                        if (result.success) {
                            Toastify({
                                text: "SektÃ¶r baÅŸarÄ±yla eklendi.",
                                duration: 3000,
                                backgroundColor: "green",
                                close: true
                            }).showToast();
                            $('#sector').append(new Option(newSectorName, newSectorName));
                            $('#newSector').val('');
                        } else {
                            Toastify({
                                text: result.message,
                                duration: 3000,
                                backgroundColor: "red",
                                close: true
                            }).showToast();
                        }
                    },
                    error: function (err) {
                        Toastify({
                            text: "SektÃ¶r eklenirken bir hata oluÅŸtu.",
                            duration: 3000,
                            backgroundColor: "red",
                            close: true
                        }).showToast();
                    }
                });
            } else {
                Toastify({
                    text: "LÃ¼tfen yeni sektÃ¶r adÄ±nÄ± girin.",
                    duration: 3000,
                    backgroundColor: "red",
                    close: true
                }).showToast();
            }
        });


        // Sayfa yÃ¼klendiÄŸinde, eÄŸer silme iÅŸlemi baÅŸarÄ±lÄ± olduysa Toastify mesajÄ±nÄ± gÃ¶ster
        $(document).ready(function () {
            if (localStorage.getItem('customerDeleted') === 'true') {
                Toastify({
                    text: "MÃ¼ÅŸteri baÅŸarÄ±yla silindi ðŸ¥³",
                    duration: 3000,
                    gravity: "top",
                    position: "center", // Bildirim hizalamasÄ± (left, center, right)
                    backgroundColor: "#4CAF50", // BaÅŸarÄ± durumu (yeÅŸil)
                    stopOnFocus: true, // TÄ±klama ile zamanlayÄ±cÄ±yÄ± durdur
                }).showToast();

                // Mesaj gÃ¶sterildikten sonra flag'i temizle
                localStorage.removeItem('customerDeleted');
            }
        });
        $('#deleteSectorButton').on('click', function () {
            var sectorName = $('#sector').val();
            if (sectorName) {
                Swal.fire({
                    title: 'Emin misiniz?',
                    text: "Bu sektÃ¶rÃ¼ silmek istediÄŸinize emin misiniz?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Evet, sil!',
                    cancelButtonText: 'HayÄ±r, iptal et'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '@Url.Action("DeleteSectorByName", "Customer")',
                            type: 'POST',
                            data: { name: sectorName },
                            success: function (result) {
                                if (result.success) {
                                    Swal.fire('BaÅŸarÄ±lÄ±!', 'SektÃ¶r baÅŸarÄ±yla silindi.', 'success').then(() => {
                                        $('#sector option[value="' + sectorName + '"]').remove();
                                    });
                                } else {
                                    Swal.fire('Silme iÅŸlemi yapÄ±lamadÄ±!', result.message, 'error');
                                }
                            },
                            error: function (err) {

                                Swal.fire('Hata!', 'SektÃ¶r silinirken bir hata oluÅŸtu.', 'error');
                            }
                        });
                    }
                });
            } else {
                // Hata mesajÄ±nÄ± gÃ¶stermek iÃ§in Toastify kullanÄ±mÄ±
                Toastify({
                    text: "Hata! LÃ¼tfen silmek istediÄŸiniz sektÃ¶rÃ¼ seÃ§in.",
                    duration: 3000, // Bildirim 3 saniye gÃ¶rÃ¼necek
                    close: true, // Kapatma butonu eklendi
                    gravity: "top", // EkranÄ±n Ã¼st kÄ±smÄ±nda gÃ¶ster
                    position: "center", // Ortada konumlandÄ±r
                    backgroundColor: "#FF4F4F", // Hata rengi iÃ§in kÄ±rmÄ±zÄ± ton
                    stopOnFocus: true, // Ãœzerine tÄ±klanÄ±nca duraklatma
                }).showToast();
            }
        });

        // Åžehirleri yÃ¼kleme
        $.get('/Customer/GetCities', function (data) {
            if (data && data.length > 0) {
                $('#city').empty();
                $('#city').append('<option value="">SeÃ§iniz</option>');
                $.each(data, function (index, value) {
                    $('#city').append('<option value="' + value + '">' + value + '</option>');
                });
            } else {
                $('#city').append('<option value="">Veri yÃ¼klenemedi</option>');
            }
        });

        // Ä°lÃ§e bilgilerini seÃ§ilen ÅŸehre gÃ¶re yÃ¼kleme
        $('#city').change(function () {
            var city = $(this).val();
            if (city) {
                $.get('/Customer/GetDistricts', { city: city }, function (data) {
                    $('#district').empty();
                    $('#district').append('<option value="">SeÃ§iniz</option>');
                    $.each(data, function (index, value) {
                        $('#district').append('<option value="' + value + '">' + value + '</option>');
                    });
                });
            } else {
                $('#district').empty();
                $('#district').append('<option value="">SeÃ§iniz</option>');
            }
        });
        $('#addCustomerForm').on('submit', function (e) {
            e.preventDefault();

            var formData = $(this).serialize();
            var token = $('input[name="__RequestVerificationToken"]').val();

            $.ajax({
                url: '/Customer/AddCustomer',
                type: 'POST',
                data: formData + '&__RequestVerificationToken=' + token,
                success: function (result) {
                    if (result.success) {
                        // BaÅŸarÄ± mesajÄ±
                        Toastify({
                            text: "MÃ¼ÅŸteri baÅŸarÄ±yla eklendi ðŸ¥³",
                            duration: 3000, // 3 saniye gÃ¶sterim sÃ¼resi
                            gravity: "top", // Bildirim konumu Ã¼stte
                            position: "right", // SaÄŸda gÃ¶ster
                            backgroundColor: "#4CAF50", // YeÅŸil arkaplan (baÅŸarÄ±)
                            stopOnFocus: true // Fareyle Ã¼zerine gelince durdur
                        }).showToast();

                        setTimeout(function () {
                            location.reload();
                        }, 2000); // SayfayÄ± 2 saniye sonra yeniler

                    } else if (result.message && result.message.includes("Bu isimle baÅŸlayan mevcut firmalar")) {
                        // Benzer firma var uyarÄ±sÄ±
                        Swal.fire({
                            title: 'UyarÄ±',
                            text: result.message,
                            icon: 'warning',
                            showCancelButton: true,
                            confirmButtonText: 'Evet, ekle',
                            cancelButtonText: 'Ä°ptal'
                        }).then((willAdd) => {
                            if (willAdd.isConfirmed) {
                                // KullanÄ±cÄ± onayladÄ±ysa, tekrardan eklemek iÃ§in isteÄŸi gÃ¶nder
                                $.ajax({
                                    url: '/Customer/AddCustomer',
                                    type: 'POST',
                                    data: formData + '&__RequestVerificationToken=' + token + '&forceAdd=true',
                                    success: function (secondResult) {
                                        if (secondResult.success) {
                                            // BaÅŸarÄ± mesajÄ±
                                            Toastify({
                                                text: "MÃ¼ÅŸteri baÅŸarÄ±yla eklendi ðŸ¥³",
                                                duration: 3000, // 3 saniye gÃ¶sterim sÃ¼resi
                                                gravity: "top", // Bildirim konumu Ã¼stte
                                                position: "right", // SaÄŸda gÃ¶ster
                                                backgroundColor: "#4CAF50", // YeÅŸil arkaplan (baÅŸarÄ±)
                                                stopOnFocus: true // Fareyle Ã¼zerine gelince durdur
                                            }).showToast();

                                            setTimeout(function () {
                                                location.reload();
                                            }, 2000); // SayfayÄ± 2 saniye sonra yeniler
                                        } else {
                                            // Hata mesajÄ±
                                            Toastify({
                                                text: secondResult.message,
                                                duration: 5000, // 5 saniye gÃ¶sterim sÃ¼resi
                                                gravity: "top",
                                                position: "right",
                                                backgroundColor: "#FF0000", // KÄ±rmÄ±zÄ± arkaplan (hata)
                                                stopOnFocus: true
                                            }).showToast();
                                        }
                                    },
                                    error: function (err) {
                                        // AJAX hata mesajÄ±
                                        Toastify({
                                            text: "Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.",
                                            duration: 5000, // 5 saniye gÃ¶sterim sÃ¼resi
                                            gravity: "top",
                                            position: "right",
                                            backgroundColor: "#FF0000", // KÄ±rmÄ±zÄ± arkaplan (hata)
                                            stopOnFocus: true
                                        }).showToast();
                                    }
                                });

                            }
                        });
                    } else {
                        // DiÄŸer hata mesajlarÄ±
                        Swal.fire({
                            icon: 'error',
                            title: 'Hata',
                            text: result.message || 'Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.'
                        });
                    }
                },
                error: function (err) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Hata',
                        text: 'Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.'
                    });
                }
            });
        });

        $(document).ready(function () {
            // Tablo satÄ±rlarÄ±nÄ± al
            var rows = $('.user-table tbody tr');

            // SatÄ±rlarÄ± sÄ±ralamak iÃ§in bir dizi oluÅŸtur
            rows.sort(function (a, b) {
                var idA = parseInt($(a).find('td').eq(0).text()); // Ä°lk hÃ¼credeki ID
                var idB = parseInt($(b).find('td').eq(0).text()); // Ä°lk hÃ¼credeki ID
                return idB - idA; // BÃ¼yÃ¼kten kÃ¼Ã§Ã¼ÄŸe sÄ±ralama
            });

            // SÄ±ralanmÄ±ÅŸ satÄ±rlarÄ± tekrar tabloya ekle
            $('.user-table tbody').empty().append(rows);
        });


        function handleFormSuccess(result) {
            if (result.success) {
                var newCustomer = result.customer;

                // MÃ¼ÅŸteri verilerini kontrol ederek boÅŸ veya undefined ise varsayÄ±lan deÄŸerler kullan
                var newCustomerId = newCustomer.Id || '';
                var newCustomerSector = newCustomer.Sector || '';
                var newCustomerName = newCustomer.Name || '';
                var newCustomerCity = newCustomer.City || '';
                var newCustomerDistrict = newCustomer.District || '';
                var newCustomerCreatedBy = newCustomer.CreatedBy || '';

                var detailUrl = '@Url.Action("CustomerDetail", "Customer")' + '?id=' + newCustomerId;

                var newRow = `<tr>
       
            <td>${newCustomerId}</td>
            <td>${newCustomerSector}</td>
            <td>${newCustomerName}</td>
            <td>${newCustomerCity}</td>
            <td>${newCustomerDistrict}</td>
            <td>${newCustomerCreatedBy}</td>
            <td>
                <a class="btn btn-outline-success" href="${detailUrl}">
                    <i class="fa fa-info-circle"></i>
                </a>
                <button class="btn btn-outline-danger delete-customer" data-id="${newCustomerId}">
                    <i class="fa fa-trash"></i>
                </button>
            </td>
        </tr>`;
                $('.user-table tbody').append(newRow);

                $('#addCustomerForm')[0].reset();
                $('#addCustomerModal').modal('hide');

                // Toastify ile baÅŸarÄ±lÄ± bildirim
                Toastify({
                    text: "MÃ¼ÅŸteri baÅŸarÄ±yla eklendi.",
                    duration: 3000, // Bildirimin ekranda kalma sÃ¼resi (milisaniye)
                    // Kapatma butonunun gÃ¶sterilmesi
                    gravity: "top", // Bildirimin ekranda nerede gÃ¶sterileceÄŸi: "top" veya "bottom"
                    position: "center", // Bildirimin ekranda nereye hizalanacaÄŸÄ±: "left", "center", veya "right"
                    backgroundColor: "#4CAF50", // Bildirimin arka plan rengi
                    stopOnFocus: true, // TÄ±klayÄ±nca durdur
                }).showToast();
            } else {
                var errorMessages = (result.errors || []).join("\n"); // EÄŸer result.errors undefined ise boÅŸ bir dizi kullan

                // Toastify ile hata bildirim
                Toastify({
                    text: "KayÄ±t yapÄ±lmadÄ±!\n" + result.message + "\n" + errorMessages,
                    duration: 5000,

                    gravity: "top",
                    position: "center",
                    backgroundColor: "#FF0000",
                    stopOnFocus: true,
                }).showToast();
            }
        }

        function handleFormError(err) {
            // Toastify ile hata bildirim
            Toastify({
                text: "Hata! MÃ¼ÅŸteri eklenirken bir hata oluÅŸtu.",
                duration: 5000,

                gravity: "top",
                position: "center",
                backgroundColor: "#FF0000",
                stopOnFocus: true,
            }).showToast();
        }


        // $('#selectAll').click(function () {
        //     $('.selectCustomer').prop('checked', this.checked);
        // });

        // $(document).on('click', '.user-table tbody tr', function (e) {
        //     if (e.target.type !== 'checkbox' && e.target.type !== 'button' && e.target.tagName.toLowerCase() !== 'a') {
        //         var checkbox = $(this).find('.selectCustomer');
        //         checkbox.prop('checked', !checkbox.prop('checked'));
        //     }
        // });

        // $('#deleteSelected').click(function () {
        //     var selectedIds = $('.selectCustomer:checked').map(function () {
        //         return $(this).data('id');
        //     }).get();

        //     if (selectedIds.length > 0) {
        //         Swal.fire({
        //             title: 'SeÃ§ilen mÃ¼ÅŸterileri silmek istediÄŸinize emin misiniz? ?',
        //             text: " MÃ¼ÅŸterilere ait teklifler de silinecek !!!!",
        //             icon: 'warning',
        //             showCancelButton: true,
        //             confirmButtonColor: '#3085d6',
        //             cancelButtonColor: '#d33',
        //             confirmButtonText: 'Evet, sil!',
        //             cancelButtonText: 'HayÄ±r, iptal et'
        //         }).then((result) => {
        //             if (result.isConfirmed) {
        //                 $.ajax({
        //                     url: '@Url.Action("DeleteSelectedCustomers", "Customer")',
        //                     type: 'POST',
        //                     data: { ids: selectedIds },
        //                     traditional: true,
        //                     success: function (result) {
        //                         if (result.success) {
        //                             Toastify({
        //                                 text: "SeÃ§ilen mÃ¼ÅŸteriler baÅŸarÄ±yla silindi ðŸ¥³",
        //                                 duration: 5000,
        //                                 gravity: "top", // Bildirimin konumu: "top" veya "bottom"
        //                                 position: "center", // Bildirimin hizalamasÄ±: "left", "center", veya "right"
        //                                 backgroundColor: "#4CAF50", // BaÅŸarÄ± bildirimi rengi (yeÅŸil)
        //                                 stopOnFocus: true, // TÄ±klama ile bildirim zamanlayÄ±cÄ±yÄ± durdur
        //                             }).showToast();

        //                             setTimeout(function () {
        //                                 location.reload(); // 2 saniye sonra sayfayÄ± yenile
        //                             }, 2000);
        //                         } else {
        //                             Toastify({
        //                                 text: "Silme iÅŸlemi yapÄ±lamadÄ±! Yetkiye sahip olduÄŸunuzdan emin olun! " + result.message,
        //                                 duration: 5000,
        //                                 gravity: "top",
        //                                 position: "center",
        //                                 backgroundColor: "#FF0000", // Hata bildirimi rengi (kÄ±rmÄ±zÄ±)
        //                                 stopOnFocus: true,
        //                             }).showToast();
        //                         }
        //                     },
        //                     error: function (err) {
        //                         Toastify({
        //                             text: "Hata! Silme iÅŸlemi yapÄ±lamadÄ±! Yetkiye sahip olduÄŸunuzdan emin olun!",
        //                             duration: 5000,
        //                             gravity: "top",
        //                             position: "center",
        //                             backgroundColor: "#FF0000", // Hata bildirimi rengi (kÄ±rmÄ±zÄ±)
        //                             stopOnFocus: true,
        //                         }).showToast();
        //                     }
        //                 });
        //             }

        //         });
        //     } else {
        //         Toastify({
        //             text: "LÃ¼tfen silmek iÃ§in en az bir mÃ¼ÅŸteri seÃ§in.",
        //             duration: 3000,
        //             gravity: "top", // Bildirimin konumu: "top" veya "bottom"
        //             position: "center", // Bildirimin hizalamasÄ±: "left", "center", veya "right"
        //             backgroundColor: "orange", // UyarÄ± bildirimi rengi (turuncu)
        //             stopOnFocus: true, // TÄ±klama ile bildirim zamanlayÄ±cÄ±yÄ± durdur
        //         }).showToast();
        //     }

        // });

    });
</script>