<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M羹teri Listesi</title>
    <link rel="stylesheet" type="text/css" href="~/css/listcustomer.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>

</head>

@using System.Security.Claims
@{
var firstName = System.Net.WebUtility.HtmlDecode(User.FindFirst("FirstName")?.Value ?? string.Empty);
var lastName = System.Net.WebUtility.HtmlDecode(User.FindFirst("LastName")?.Value ?? string.Empty);

ViewBag.UserName = $"{firstName} {lastName}";
}

<div class="container">
    <h4 class="display-4 text-center">M羹teri Listesi</h4>
    <hr>
    <div class="d-flex justify-content-between align-items-center mb-3" style="gap: 10px;">
        <input type="text" class="form-control search-input-custom" id="searchInput"
            placeholder="Herhangi bir parametre ile ara..." style="margin: 0; flex-grow: 1; height: 60px;">

    </div>
    <hr>
    <div class="button-container">
        <div class="button-group">
            <button class="btn btn-outline-dark mb-3 btn-lg" data-toggle="modal" data-target="#addCustomerModal">
                M羹teri Ekle <i class="fa-solid fa-user-plus"></i>
            </button>
            <button class="btn btn-outline-dark mb-3 btn-lg" onclick="exportTableToExcel('user-table', 'MusteriListesi.xlsx')">
                Tabloyu Excel'e Aktar <i class="fa-solid fa-download"></i>
            </button>
            
            
        </div>
        <!-- <button class="btn btn-outline-dark mb-3 btn-lg" id="deleteSelected">
            Se癟ilen M羹terileri Sil <i class="fa fa-trash"></i>
        </button> -->
    </div>
    <div class="table-header" style="text-align: center;">
        <h5 id="customerCount" style="font-size: 1.2em; font-weight: bold; color: #4F75FF; border: 2px solid #4379F2; display: inline-block; padding: 10px 20px; border-radius: 8px; background-color: #f0f8ff;">
            Listelenen M羹terilerinizin Say覺s覺: 0
        </h5>
    </div>
    <div class="table-responsive">
       <table id="user-table" class="user-table table table-bordered">

            <thead>
                <tr>
                    <!-- <th><input type="checkbox" id="selectAll"></th> -->
                    <th>Id</th>
                    <th>Sekt繹r</th>
                    <th>Ad</th>
                    <th>襤l</th>
                    <th>襤l癟e</th>
                    <th>M羹teri Sorumlusu</th>
                    <th>襤lemler</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null)
                {
                foreach (var customer in Model)
                {
                <tr>
                    <!-- <td><input type="checkbox" class="selectCustomer" data-id="@customer.Id"></td> -->
                    <td>@customer.Id</td>
                    <td>@customer.Sector</td>
                    <td>@customer.Name</td>
                    <td>@customer.City</td>
                    <td>@customer.District</td>
                    <td>@customer.CreatedBy</td>

                    <!-- Table Cell -->
                    <td style="text-align: center; vertical-align: middle;">
                        <!-- Button Element -->
                        <a class="btn btn-dark" href="@Url.Action("CustomerDetail","Customer" , new { id=customer.Id
                            })"
                            style="display: inline-flex; justify-content: center; align-items: center; width: 60px; height: 60px;">
                            <i class='fas fa-sign-in-alt' style="font-size: 24px; margin: 0;"></i>
                        </a>
                    </td>

                </tr>
                }
                }
                else
                {
                <tr>
                    <td colspan="8">Veri y羹klenemedi</td>
                </tr>
                }
            </tbody>
        </table>
    </div>
    <hr>
</div>

<!-- Add Customer Modal -->
<div class="modal fade" id="addCustomerModal" tabindex="-1" role="dialog" aria-labelledby="addCustomerModalLabel"
    aria-hidden="true" data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="addCustomerModalLabel">M羹teri Ekle</h2>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="addCustomerForm" class="needs-validation" novalidate>
                    @Html.AntiForgeryToken()
                    <div class="form-group">
                        <label for="sector">Sekt繹r</label>
                        <div class="input-group">
                            <select class="form-control" id="sector" name="sector" required>
                                <option value="">Se癟iniz</option>
                                @foreach (var sector in ViewBag.Sectors)
                                {
                                <option value="@sector.Name">@sector.Name</option>
                                }
                            </select>
                            <div class="input-group-append">
                                <button type="button" class="btn btn-outline-danger"
                                    id="deleteSectorButton">Sil</button>
                            </div>
                        </div>
                        <div class="invalid-feedback">L羹tfen sekt繹r羹 se癟in.</div>
                    </div>
                    <div class="form-group">
                        <label for="newSector">Yeni Sekt繹r Ekle</label>
                        <input type="text" class="form-control" id="newSector" name="newSector">
                        <button type="button" class="btn btn-outline-dark mt-2" id="addSectorButton">Sekt繹r Ekle<i
                                class="fa fa-plus" aria-hidden="true"></i></button>
                        <div class="invalid-feedback">L羹tfen yeni sekt繹r ad覺n覺 girin.</div>
                    </div>
                    <div class="form-group">
                        <label for="name">Firma Ad覺</label>
                        <input type="text" class="form-control" id="name" name="name" required>
                        <div class="invalid-feedback">L羹tfen ad覺 girin.</div>
                    </div>
                    <div class="form-group">
                        <label for="city">襤l</label>
                        <select class="form-control" id="city" name="city" required>
                            <option value="">Se癟iniz</option>
                            @if (ViewBag.Cities != null)
                            {
                            @foreach (var city in ViewBag.Cities)
                            {
                            <option value="@city">@city</option>
                            }
                            }
                            else
                            {
                            <option value="">Veri y羹klenemedi</option>
                            }
                        </select>
                        <div class="invalid-feedback">L羹tfen ili se癟in.</div>
                    </div>
                    <div class="form-group">
                        <label for="district">襤l癟e</label>
                        <select class="form-control" id="district" name="district" required>
                            <option value="">Se癟iniz</option>
                        </select>
                        <div class="invalid-feedback">L羹tfen il癟eyi se癟in.</div>
                    </div>
                    <div class="form-group">
                        <label for="CreatedBy">M羹teri Sorumlusu</label>
                        <div class="input-group">
                            <input type="text" class="form-control" id="CreatedBy" name="CreatedBy" readonly
                                value="@Html.Raw(ViewBag.UserName)">
                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fa fa-handshake" aria-hidden="true"></i></span>
                            </div>
                        </div>

                        <div class="invalid-feedback">L羹tfen sahibini girin.</div>
                    </div>

                    <button type="submit" class="btn btn-outline-dark mb-3 btn-lg">M羹teri Ekle <i class="fa fa-check"
                            aria-hidden="true"></i></button>

                </form>
            </div>
        </div>
    </div>
</div>





<script>async function exportTableToExcel(tableID, filename = 'MusteriListesi.xlsx') {
    const table = document.getElementById(tableID);

    // Yeni bir workbook olutur
    const workbook = new ExcelJS.Workbook();
    const worksheet = workbook.addWorksheet("Sheet1");

    // Controller'dan gelen Contacts bilgilerini al覺n
    const contactsData = JSON.parse('@Html.Raw(ViewBag.ContactsJson)');

    // Tablo bal覺klar覺n覺 al ve "襤lemler" bal覺覺n覺 hari癟 tut
    const headerRow = table.querySelector("thead tr");
    const headers = Array.from(headerRow.querySelectorAll("th"))
        .map(cell => cell.textContent.trim())
        .filter(header => header !== "襤lemler"); // "襤lemler" s羹tununu hari癟 tut

    // Ek bal覺klar ekle (Contacts bilgileri i癟in)
    headers.push("Id", "G繹revi", "襤sim Soyisim", "Telefon", "Cinsiyet", "Email","Onay");

    const excelHeaderRow = worksheet.addRow(headers);
    excelHeaderRow.eachCell(cell => {
        cell.font = { bold: true }; // Bal覺klar覺 kal覺n yap
        cell.alignment = { horizontal: "center", vertical: "middle" }; // Ortala
    });

    // Yaln覺zca g繹r羹n羹r sat覺rlar覺 al覺n
    const rows = Array.from(table.querySelectorAll("tbody tr")).filter(row => {
        return row.style.display !== "none"; // G繹r羹n羹r sat覺rlar覺 filtrele
    });

    // Tablodaki g繹r羹n羹r sat覺r verilerini ekle
    rows.forEach(row => {
        const rowData = Array.from(row.querySelectorAll("td"))
            .map(cell => cell.textContent.trim());
        
        // "襤lemler" s羹tununun indeksini belirle ve o s羹tunu hari癟 tut
        const operationColumnIndex = Array.from(headerRow.querySelectorAll("th"))
            .findIndex(cell => cell.textContent.trim() === "襤lemler");
        
        if (operationColumnIndex !== -1) {
            rowData.splice(operationColumnIndex, 1); // "襤lemler" s羹tununu 癟覺kar
        }

        // M羹teri Id'sine g繹re Contacts bilgilerini ekle
        const customerId = row.querySelector("td:first-child").textContent.trim();
        const customerContacts = contactsData[customerId] || [];

        // Contacts verilerini ay覺kla ve ekle
        rowData.push(
            customerContacts.map(contact => contact.Id).join(", ") || "",
            customerContacts.map(contact => contact.Title).join(", ") || "",
            customerContacts.map(contact => contact.FullName).join(", ") || "",
            customerContacts.map(contact => contact.PhoneNumber).join(", ") || "",
            customerContacts.map(contact => contact.Gender).join(", ") || "",
            customerContacts.map(contact => contact.Email).join(", ") || "",
            customerContacts.map(contact => contact.IsApproved ? "Onayl覺" : "Onays覺z").join(", ") || ""

        );

        // Sat覺rlar覺 Excel'e ekle
        const excelRow = worksheet.addRow(rowData);

        // H羹creleri ortala
        excelRow.eachCell(cell => {
            cell.alignment = { horizontal: "center", vertical: "middle" }; // Ortala
        });
    });

    // Kolon geniliklerini ayarla
    worksheet.columns = headers.map(() => ({ width: 20 }));

    // Excel dosyas覺n覺 indir
    const buffer = await workbook.xlsx.writeBuffer();
    const blob = new Blob([buffer], { type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}


    document.getElementById('searchInput').addEventListener('keyup', function () {
        // Kullan覺c覺n覺n girdii arama deerini al ve T羹rk癟e karakterlere duyarl覺 olarak k羹癟羹lt
        var searchValue = this.value.toLocaleLowerCase('tr-TR').trim();

        // Arama deerini boluklara g繹re b繹l ve kelimeleri al
        var searchTerms = searchValue.split(' ').filter(function (term) {
            return term.trim() !== ''; // Bo olmayan terimleri al
        });

        // Arama ilemini balat
        filterTable(searchTerms);
    });

    function filterTable(searchTerms) {
        // Tablo sat覺rlar覺n覺 se癟
        var tableRows = document.querySelectorAll('.user-table tbody tr');

        // Her bir sat覺r覺 kontrol et
        tableRows.forEach(function (row) {
            // Sat覺r覺n text i癟eriini T羹rk癟e karakterlere duyarl覺 olarak k羹癟羹lt
            var rowText = row.textContent.toLocaleLowerCase('tr-TR').trim();

            // Her bir arama teriminin sat覺r metninde olup olmad覺覺n覺 kontrol et
            var matchesSearch = searchTerms.every(function (term) {
                return rowText.includes(term);
            });

            // Arama kriterlerine uyan sat覺rlar覺 g繹ster, uymayanlar覺 gizle
            if (matchesSearch) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
        updateCustomerCount();
    }
    function updateCustomerCount() {
        const visibleRows = document.querySelectorAll(".user-table tbody tr:not([style*='display: none'])");
        const totalCustomers = visibleRows.length;
        document.getElementById("customerCount").innerText = "Listelenen M羹terilerinizin Say覺s覺: " + totalCustomers;
    }
  // Sayfa y羹klendiinde m羹teri say覺s覺n覺 ilk olarak g羹ncelle
  document.addEventListener("DOMContentLoaded", function() {
        updateCustomerCount();
    });

    $(document).ready(function () {

        var createdBy = '@Html.Raw(ViewBag.UserName)';

        $('#addCustomerModal').on('show.bs.modal', function () {
            $('#CreatedBy').val(createdBy);

        });

        document.getElementById('newSector').addEventListener('input', function () {
            this.value = this.value.toUpperCase();
        });
        $(document).on('click', '.delete-customer', function (event) {
            event.stopPropagation(); // T覺klaman覺n sat覺r覺 se癟mesini engelle

            var customerId = $(this).data('id');

            Swal.fire({
                title: 'Emin misiniz?',
                text: "Bu m羹teriyi silmek istediinize emin misiniz?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Evet, sil!',
                cancelButtonText: 'Hay覺r, iptal et',
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: '@Url.Action("DeleteCustomer", "Customer")',
                        type: 'POST',
                        data: { id: customerId },
                        success: function (result) {
                            if (result.success) {
                                // Toastify mesaj覺n覺 g繹stermek i癟in localStorage'a bir flag ekle
                                localStorage.setItem('customerDeleted', 'true');

                                // Sayfay覺 hemen yenile
                                location.reload();
                            } else {
                                Toastify({
                                    text: "Silme ilemi yap覺lamad覺! " + result.message,
                                    duration: 5000,
                                    gravity: "top",
                                    position: "center",
                                    backgroundColor: "#FF0000", // Hata durumu (k覺rm覺z覺)
                                    stopOnFocus: true,
                                }).showToast();
                            }
                        },
                        error: function (err) {
                            Toastify({
                                text: "Hata! M羹teri silmek i癟in yetkiye sahip olduunuzdan emin olun!",
                                duration: 5000, // 5 saniye boyunca g繹r羹n羹r

                                gravity: "top",
                                position: "center",
                                backgroundColor: "#FF0000", // Hata durumu (k覺rm覺z覺)
                                stopOnFocus: true,
                            }).showToast();
                        }

                    });
                    // Checkbox se癟im ilemi i癟in t覺klama olay覺n覺 ayr覺 y繹net
                    // $('.user-table tbody').on('click', 'tr', function (event) {
                    //     if (!$(event.target).is('.delete-customer, .btn-outline-success, .fa-pencil-alt, .fa-trash, input[type="checkbox"]')) {
                    //         // T覺klanan yer silme butonu veya d羹zenleme butonu deilse
                    //         var checkbox = $(this).find('.selectCustomer');
                    //         checkbox.prop('checked', !checkbox.prop('checked'));
                    //     }
                    // });

                }
            });
        });

        $('#addSectorButton').on('click', function () {
            var newSectorName = $('#newSector').val();
            if (newSectorName) {
                $.ajax({
                    url: '@Url.Action("AddSector", "Customer")',
                    type: 'POST',
                    data: { name: newSectorName },
                    success: function (result) {
                        if (result.success) {
                            Toastify({
                                text: "Sekt繹r baar覺yla eklendi.",
                                duration: 3000,
                                backgroundColor: "green",
                                close: true
                            }).showToast();
                            $('#sector').append(new Option(newSectorName, newSectorName));
                            $('#newSector').val('');
                        } else {
                            Toastify({
                                text: result.message,
                                duration: 3000,
                                backgroundColor: "red",
                                close: true
                            }).showToast();
                        }
                    },
                    error: function (err) {
                        Toastify({
                            text: "Sekt繹r eklenirken bir hata olutu.",
                            duration: 3000,
                            backgroundColor: "red",
                            close: true
                        }).showToast();
                    }
                });
            } else {
                Toastify({
                    text: "L羹tfen yeni sekt繹r ad覺n覺 girin.",
                    duration: 3000,
                    backgroundColor: "red",
                    close: true
                }).showToast();
            }
        });


        // Sayfa y羹klendiinde, eer silme ilemi baar覺l覺 olduysa Toastify mesaj覺n覺 g繹ster
        $(document).ready(function () {
            if (localStorage.getItem('customerDeleted') === 'true') {
                Toastify({
                    text: "M羹teri baar覺yla silindi 戊",
                    duration: 3000,
                    gravity: "top",
                    position: "center", // Bildirim hizalamas覺 (left, center, right)
                    backgroundColor: "#4CAF50", // Baar覺 durumu (yeil)
                    stopOnFocus: true, // T覺klama ile zamanlay覺c覺y覺 durdur
                }).showToast();

                // Mesaj g繹sterildikten sonra flag'i temizle
                localStorage.removeItem('customerDeleted');
            }
        });
        $('#deleteSectorButton').on('click', function () {
            var sectorName = $('#sector').val();
            if (sectorName) {
                Swal.fire({
                    title: 'Emin misiniz?',
                    text: "Bu sekt繹r羹 silmek istediinize emin misiniz?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Evet, sil!',
                    cancelButtonText: 'Hay覺r, iptal et'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $.ajax({
                            url: '@Url.Action("DeleteSectorByName", "Customer")',
                            type: 'POST',
                            data: { name: sectorName },
                            success: function (result) {
                                if (result.success) {
                                    Swal.fire('Baar覺l覺!', 'Sekt繹r baar覺yla silindi.', 'success').then(() => {
                                        $('#sector option[value="' + sectorName + '"]').remove();
                                    });
                                } else {
                                    Swal.fire('Silme ilemi yap覺lamad覺!', result.message, 'error');
                                }
                            },
                            error: function (err) {
                                
                                Swal.fire('Hata!', 'Sekt繹r silinirken bir hata olutu.', 'error');
                            }
                        });
                    }
                });
            } else {
               // Hata mesaj覺n覺 g繹stermek i癟in Toastify kullan覺m覺
  Toastify({
    text: "Hata! L羹tfen silmek istediiniz sekt繹r羹 se癟in.",
    duration: 3000, // Bildirim 3 saniye g繹r羹necek
    close: true, // Kapatma butonu eklendi
    gravity: "top", // Ekran覺n 羹st k覺sm覺nda g繹ster
    position: "center", // Ortada konumland覺r
    backgroundColor: "#FF4F4F", // Hata rengi i癟in k覺rm覺z覺 ton
    stopOnFocus: true, // zerine t覺klan覺nca duraklatma
  }).showToast();
            }
        });

        // ehirleri y羹kleme
        $.get('/Customer/GetCities', function (data) {
            if (data && data.length > 0) {
                $('#city').empty();
                $('#city').append('<option value="">Se癟iniz</option>');
                $.each(data, function (index, value) {
                    $('#city').append('<option value="' + value + '">' + value + '</option>');
                });
            } else {
                $('#city').append('<option value="">Veri y羹klenemedi</option>');
            }
        });

        // 襤l癟e bilgilerini se癟ilen ehre g繹re y羹kleme
        $('#city').change(function () {
            var city = $(this).val();
            if (city) {
                $.get('/Customer/GetDistricts', { city: city }, function (data) {
                    $('#district').empty();
                    $('#district').append('<option value="">Se癟iniz</option>');
                    $.each(data, function (index, value) {
                        $('#district').append('<option value="' + value + '">' + value + '</option>');
                    });
                });
            } else {
                $('#district').empty();
                $('#district').append('<option value="">Se癟iniz</option>');
            }
        });
        $('#addCustomerForm').on('submit', function (e) {
    e.preventDefault();

    var formData = $(this).serialize();
    var token = $('input[name="__RequestVerificationToken"]').val();

    $.ajax({
    url: '/Customer/AddCustomer',
    type: 'POST',
    data: formData + '&__RequestVerificationToken=' + token,
    success: function (result) {
        if (result.success) {
            // Baar覺 mesaj覺
            Toastify({
                text: "M羹teri baar覺yla eklendi 戊",
                duration: 3000, // 3 saniye g繹sterim s羹resi
                gravity: "top", // Bildirim konumu 羹stte
                position: "right", // Sada g繹ster
                backgroundColor: "#4CAF50", // Yeil arkaplan (baar覺)
                stopOnFocus: true // Fareyle 羹zerine gelince durdur
            }).showToast();

            setTimeout(function () {
                location.reload();
            }, 2000); // Sayfay覺 2 saniye sonra yeniler

            } else if (result.message && result.message.includes("Bu isimle balayan mevcut firmalar")) {
                // Benzer firma var uyar覺s覺
                Swal.fire({
                    title: 'Uyar覺',
                    text: result.message,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonText: 'Evet, ekle',
                    cancelButtonText: '襤ptal'
                }).then((willAdd) => {
                    if (willAdd.isConfirmed) {
                        // Kullan覺c覺 onaylad覺ysa, tekrardan eklemek i癟in istei g繹nder
                       $.ajax({
    url: '/Customer/AddCustomer',
    type: 'POST',
    data: formData + '&__RequestVerificationToken=' + token + '&forceAdd=true',
    success: function (secondResult) {
        if (secondResult.success) {
            // Baar覺 mesaj覺
            Toastify({
                text: "M羹teri baar覺yla eklendi 戊",
                duration: 3000, // 3 saniye g繹sterim s羹resi
                gravity: "top", // Bildirim konumu 羹stte
                position: "right", // Sada g繹ster
                backgroundColor: "#4CAF50", // Yeil arkaplan (baar覺)
                stopOnFocus: true // Fareyle 羹zerine gelince durdur
            }).showToast();

            setTimeout(function () {
                location.reload();
            }, 2000); // Sayfay覺 2 saniye sonra yeniler
        } else {
            // Hata mesaj覺
            Toastify({
                text: secondResult.message,
                duration: 5000, // 5 saniye g繹sterim s羹resi
                gravity: "top",
                position: "right",
                backgroundColor: "#FF0000", // K覺rm覺z覺 arkaplan (hata)
                stopOnFocus: true
            }).showToast();
        }
    },
    error: function (err) {
        // AJAX hata mesaj覺
        Toastify({
            text: "Bir hata olutu, l羹tfen tekrar deneyin.",
            duration: 5000, // 5 saniye g繹sterim s羹resi
            gravity: "top",
            position: "right",
            backgroundColor: "#FF0000", // K覺rm覺z覺 arkaplan (hata)
            stopOnFocus: true
        }).showToast();
    }
});

                    }
                });
            } else {
                // Dier hata mesajlar覺
                Swal.fire({
                    icon: 'error',
                    title: 'Hata',
                    text: result.message || 'Bir hata olutu, l羹tfen tekrar deneyin.'
                });
            }
        },
        error: function (err) {
            Swal.fire({
                icon: 'error',
                title: 'Hata',
                text: 'Bir hata olutu, l羹tfen tekrar deneyin.'
            });
        }
    });
});

        $(document).ready(function () {
            // Tablo sat覺rlar覺n覺 al
            var rows = $('.user-table tbody tr');

            // Sat覺rlar覺 s覺ralamak i癟in bir dizi olutur
            rows.sort(function (a, b) {
                var idA = parseInt($(a).find('td').eq(0).text()); // 襤lk h羹credeki ID
                var idB = parseInt($(b).find('td').eq(0).text()); // 襤lk h羹credeki ID
                return idB - idA; // B羹y羹kten k羹癟羹e s覺ralama
            });

            // S覺ralanm覺 sat覺rlar覺 tekrar tabloya ekle
            $('.user-table tbody').empty().append(rows);
        });


        function handleFormSuccess(result) {
            if (result.success) {
                var newCustomer = result.customer;

                // M羹teri verilerini kontrol ederek bo veya undefined ise varsay覺lan deerler kullan
                var newCustomerId = newCustomer.Id || '';
                var newCustomerSector = newCustomer.Sector || '';
                var newCustomerName = newCustomer.Name || '';
                var newCustomerCity = newCustomer.City || '';
                var newCustomerDistrict = newCustomer.District || '';
                var newCustomerCreatedBy = newCustomer.CreatedBy || '';

                var detailUrl = '@Url.Action("CustomerDetail", "Customer")' + '?id=' + newCustomerId;

                var newRow = `<tr>
       
            <td>${newCustomerId}</td>
            <td>${newCustomerSector}</td>
            <td>${newCustomerName}</td>
            <td>${newCustomerCity}</td>
            <td>${newCustomerDistrict}</td>
            <td>${newCustomerCreatedBy}</td>
            <td>
                <a class="btn btn-outline-success" href="${detailUrl}">
                    <i class="fa fa-info-circle"></i>
                </a>
                <button class="btn btn-outline-danger delete-customer" data-id="${newCustomerId}">
                    <i class="fa fa-trash"></i>
                </button>
            </td>
        </tr>`;
                $('.user-table tbody').append(newRow);

                $('#addCustomerForm')[0].reset();
                $('#addCustomerModal').modal('hide');

                // Toastify ile baar覺l覺 bildirim
                Toastify({
                    text: "M羹teri baar覺yla eklendi.",
                    duration: 3000, // Bildirimin ekranda kalma s羹resi (milisaniye)
                    // Kapatma butonunun g繹sterilmesi
                    gravity: "top", // Bildirimin ekranda nerede g繹sterilecei: "top" veya "bottom"
                    position: "center", // Bildirimin ekranda nereye hizalanaca覺: "left", "center", veya "right"
                    backgroundColor: "#4CAF50", // Bildirimin arka plan rengi
                    stopOnFocus: true, // T覺klay覺nca durdur
                }).showToast();
            } else {
                var errorMessages = (result.errors || []).join("\n"); // Eer result.errors undefined ise bo bir dizi kullan

                // Toastify ile hata bildirim
                Toastify({
                    text: "Kay覺t yap覺lmad覺!\n" + result.message + "\n" + errorMessages,
                    duration: 5000,

                    gravity: "top",
                    position: "center",
                    backgroundColor: "#FF0000",
                    stopOnFocus: true,
                }).showToast();
            }
        }

        function handleFormError(err) {
            // Toastify ile hata bildirim
            Toastify({
                text: "Hata! M羹teri eklenirken bir hata olutu.",
                duration: 5000,

                gravity: "top",
                position: "center",
                backgroundColor: "#FF0000",
                stopOnFocus: true,
            }).showToast();
        }


        // $('#selectAll').click(function () {
        //     $('.selectCustomer').prop('checked', this.checked);
        // });

        // $(document).on('click', '.user-table tbody tr', function (e) {
        //     if (e.target.type !== 'checkbox' && e.target.type !== 'button' && e.target.tagName.toLowerCase() !== 'a') {
        //         var checkbox = $(this).find('.selectCustomer');
        //         checkbox.prop('checked', !checkbox.prop('checked'));
        //     }
        // });

        // $('#deleteSelected').click(function () {
        //     var selectedIds = $('.selectCustomer:checked').map(function () {
        //         return $(this).data('id');
        //     }).get();

        //     if (selectedIds.length > 0) {
        //         Swal.fire({
        //             title: 'Se癟ilen m羹terileri silmek istediinize emin misiniz? ?',
        //             text: " M羹terilere ait teklifler de silinecek !!!!",
        //             icon: 'warning',
        //             showCancelButton: true,
        //             confirmButtonColor: '#3085d6',
        //             cancelButtonColor: '#d33',
        //             confirmButtonText: 'Evet, sil!',
        //             cancelButtonText: 'Hay覺r, iptal et'
        //         }).then((result) => {
        //             if (result.isConfirmed) {
        //                 $.ajax({
        //                     url: '@Url.Action("DeleteSelectedCustomers", "Customer")',
        //                     type: 'POST',
        //                     data: { ids: selectedIds },
        //                     traditional: true,
        //                     success: function (result) {
        //                         if (result.success) {
        //                             Toastify({
        //                                 text: "Se癟ilen m羹teriler baar覺yla silindi 戊",
        //                                 duration: 5000,
        //                                 gravity: "top", // Bildirimin konumu: "top" veya "bottom"
        //                                 position: "center", // Bildirimin hizalamas覺: "left", "center", veya "right"
        //                                 backgroundColor: "#4CAF50", // Baar覺 bildirimi rengi (yeil)
        //                                 stopOnFocus: true, // T覺klama ile bildirim zamanlay覺c覺y覺 durdur
        //                             }).showToast();

        //                             setTimeout(function () {
        //                                 location.reload(); // 2 saniye sonra sayfay覺 yenile
        //                             }, 2000);
        //                         } else {
        //                             Toastify({
        //                                 text: "Silme ilemi yap覺lamad覺! Yetkiye sahip olduunuzdan emin olun! " + result.message,
        //                                 duration: 5000,
        //                                 gravity: "top",
        //                                 position: "center",
        //                                 backgroundColor: "#FF0000", // Hata bildirimi rengi (k覺rm覺z覺)
        //                                 stopOnFocus: true,
        //                             }).showToast();
        //                         }
        //                     },
        //                     error: function (err) {
        //                         Toastify({
        //                             text: "Hata! Silme ilemi yap覺lamad覺! Yetkiye sahip olduunuzdan emin olun!",
        //                             duration: 5000,
        //                             gravity: "top",
        //                             position: "center",
        //                             backgroundColor: "#FF0000", // Hata bildirimi rengi (k覺rm覺z覺)
        //                             stopOnFocus: true,
        //                         }).showToast();
        //                     }
        //                 });
        //             }

        //         });
        //     } else {
        //         Toastify({
        //             text: "L羹tfen silmek i癟in en az bir m羹teri se癟in.",
        //             duration: 3000,
        //             gravity: "top", // Bildirimin konumu: "top" veya "bottom"
        //             position: "center", // Bildirimin hizalamas覺: "left", "center", veya "right"
        //             backgroundColor: "orange", // Uyar覺 bildirimi rengi (turuncu)
        //             stopOnFocus: true, // T覺klama ile bildirim zamanlay覺c覺y覺 durdur
        //         }).showToast();
        //     }

        // });

    });
</script>